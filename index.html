<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Minecraft File Manager</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
  :root {
    --primary: #7f5af0;
    --primary-light: #9374f3;
    --background: #18181b;
    --surface: #232338;
    --surface-light: #2d2d45;
    --accent: #5ffbf1;
    --accent-dark: #4bd1c8;
    --danger: #ff5470;
    --danger-light: #ff7a90;
    --success: #36f09f;
    --warning: #E6C200;
    --text-primary: #f8fafc;
    --text-secondary: #d4d6e0;
    --text-muted: #9497a1;
    --border-radius: 12px;
    --shadow: 0 4px 20px rgba(0,0,0,0.2);
    --transition: all 0.3s ease;
    font-family: 'Montserrat', system-ui, Segoe UI, Roboto, Arial;
    color: var(--text-primary);
    font-size: 16px;
  }

  /* Base styles */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  
  html {
    font-size: 100%;
    scroll-behavior: smooth;
  }
  
  body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    background: linear-gradient(120deg, var(--surface) 0%, var(--primary) 100%);
    display: flex;
    flex-direction: column;
    min-width: 320px;
    line-height: 1.6;
  }
  
  img, video {
    max-width: 100%;
    height: auto;
  }
  
  /* Typography */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
    line-height: 1.3;
  }
  
  /* Header */
  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.25rem 1.5rem;
    background: var(--surface);
    color: #fff;
    box-shadow: var(--shadow);
    position: sticky;
    top: 0;
    z-index: 100;
  }
  
  header h1 {
    margin: 0;
    font-size: 2rem;
    background: linear-gradient(90deg, var(--accent), var(--primary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  
  /* Main container */
  .container {
    flex: 1;
    display: flex;
    flex-direction: column;
    padding: 1.5rem;
    max-width: 800px;
    width: 90%;
    margin: 2rem auto;
    gap: 1.5rem;
  }
  
  /* Notice box */
    .notice-box {
  text-align: center;
  padding: 1.25rem;
  border: 2px dashed var(--primary);
  border-radius: var(--border-radius);
  background-color: rgba(255, 255, 255, 0.05);
  display: flex;
  flex-direction: column;
  align-items: center;
}
  .notice-box h2 {
    color: var(--warning);
    margin-top: 0;
    margin-bottom: 0.75rem;
  }
  
  .notice-box p {
    margin: 0.5rem 0;
  }
  
  .notice-box a {
    color: var(--success);
    font-weight: 600;
    text-decoration: none;
    transition: var(--transition);
  }
  
  .notice-box a:hover,
  .notice-box a:focus {
    text-decoration: underline;
    color: var(--accent);
  }
  
  /* Search input */
  #searchInput {
    background-color: rgba(255, 255, 255, 0.9);
    padding: 0.75rem;
    width: 100%;
    border-radius: 8px;
    border: 2px solid var(--primary);
    margin-top: 1rem;
    font-family: inherit;
    font-size: 1rem;
    transition: var(--transition);
  }
  
  #searchInput:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(95, 251, 241, 0.3);
  }
  
  /* Files container */
  .files {
    background: var(--surface);
    padding: 1.25rem;
    border-radius: var(--border-radius);
    min-height: 200px;
    max-height: 70vh;
    overflow-y: auto;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    gap: 0;
    box-shadow: var(--shadow);
  }
  
  /* File item */
  .file {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 1.25rem 0;
    border-bottom: 1px solid var(--surface-light);
    position: relative;
    gap: 0.75rem;
  }
  
  .file:last-child {
    border-bottom: none;
  }
  
  /* Thumbnail */
  .thumbnail {
    width: 200px;
    max-width: 90%;
    height: auto;
    border-radius: var(--border-radius);
    object-fit: cover;
    background: var(--surface);
    border: 4px solid var(--accent);
    transition: var(--transition);
  }
  
  .thumbnail:hover {
    transform: scale(1.03);
    border-color: var(--accent-dark);
  }
  
  /* File name */
  .name {
    font-weight: 700;
    color: var(--accent);
    word-break: break-word;
    text-align: center;
    font-size: 1.15rem;
  }
  
  /* Meta information */
  .meta {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    justify-content: center;
    margin-top: 0.5rem;
    flex-wrap: wrap;
    color: var(--text-secondary);
    font-size: 0.9rem;
  }
  
  /* Actions */
  .actions {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    margin-top: 0.75rem;
    flex-wrap: wrap;
  }
  
  /* Buttons */
  .btn {
    background: linear-gradient(90deg, var(--primary), var(--accent));
    color: #fff;
    padding: 0.75rem 1.25rem;
    border-radius: 8px;
    border: 0;
    cursor: pointer;
    font-weight: 600;
    font-family: inherit;
    font-size: 0.95rem;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    text-decoration: none;
    max-width: 100%;
    word-wrap: break-word;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  
  .btn:hover,
  .btn:focus {
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
  }
  
  .btn:active {
    transform: translateY(0);
  }
  
  .btn.danger {
    background: linear-gradient(90deg, var(--danger), var(--danger-light));
  }
  
  .btn.secondary {
    background: linear-gradient(90deg, var(--surface), var(--primary));
    border: 1px solid var(--accent);
  }
  
  .btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
  }
  
  /* Loading overlay */
  #loadingOverlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(20, 20, 30, 0.9);
    z-index: 9999;
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    backdrop-filter: blur(5px);
  }
  
  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    border-top-color: var(--accent);
    animation: spin 1s ease-in-out infinite;
    margin-bottom: 1.5rem;
  }
  
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
  
  #loadingText {
    color: var(--text-primary);
    font-size: 1.25rem;
    font-weight: 500;
    text-align: center;
  }
  
  /* Downloading screen */
  #downloadingScreen {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(20, 20, 30, 0.95);
    z-index: 10000;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 1.5rem;
  }
  
  #downloadBar {
    width: 100%;
    max-width: 500px;
    background: var(--surface);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  #downloadFileName {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 1rem;
    word-break: break-word;
    text-align: center;
  }
  
  #progressBarContainer {
    width: 100%;
    background: var(--background);
    border-radius: 8px;
    margin: 1rem 0;
    height: 24px;
    overflow: hidden;
  }
  
  #progressBar {
    background: linear-gradient(90deg, var(--primary), var(--accent));
    height: 100%;
    width: 0;
    transition: width 0.3s ease;
    border-radius: 8px;
  }
  
  #progressText {
    color: var(--accent);
    font-weight: 600;
    font-size: 1rem;
    text-align: center;
    white-space: pre-line;
    margin-bottom: 1rem;
  }
  
  #downloadCancelBtn {
    background: linear-gradient(90deg, var(--danger), var(--danger-light));
    color: #fff;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    border: 0;
    cursor: pointer;
    font-weight: 600;
    font-family: inherit;
    transition: var(--transition);
  }
  
  #downloadCancelBtn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }
  
  /* Footer buttons */
  .footer-buttons-bottom {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin: 1.5rem 0 0.5rem;
    flex-wrap: wrap;
  }
  
  .footer-btn {
    background: transparent;
    color: var(--warning);
    border: 1px solid var(--warning);
    padding: 0.5rem 1rem;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    font-family: inherit;
    transition: var(--transition);
    text-decoration: none;
  }
  
  .footer-btn:hover,
  .footer-btn:focus {
    background-color: rgba(230, 194, 0, 0.1);
    color: var(--accent);
    border-color: var(--accent);
  }
  
  /* Modal */
  .footer-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(22, 22, 32, 0.95);
    z-index: 9999999;
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    animation: fadeInModal 0.3s ease;
    padding: 1.5rem;
  }
  
  @keyframes fadeInModal {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  
  .footer-modal-content {
    background: var(--surface);
    color: var(--text-primary);
    border-radius: var(--border-radius);
    max-width: 95vw;
    width: 500px;
    padding: 2rem;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    gap: 1.25rem;
    align-items: center;
    position: relative;
    text-align: left;
    font-size: 1rem;
    max-height: 80vh;
    overflow-y: auto;
  }
  
  .footer-section-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 0.5rem;
    text-align: center;
  }
  
  .footer-section-content {
    color: var(--text-secondary);
    line-height: 1.6;
    font-size: 1rem;
    margin-bottom: 0.5rem;
    word-break: break-word;
  }
  
  .footer-contact-link {
    color: var(--primary-light);
    text-decoration: underline;
    font-weight: 600;
    word-break: break-word;
    transition: var(--transition);
  }
  
  .footer-contact-link:hover,
  .footer-contact-link:focus {
    color: var(--accent);
  }
  
  .footer-modal-back {
    background: linear-gradient(90deg, var(--danger), var(--danger-light));
    color: #fff;
    border: none;
    border-radius: 7px;
    font-weight: 600;
    padding: 0.6rem 1.25rem;
    cursor: pointer;
    font-size: 1rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    transition: var(--transition);
  }
  
  .footer-modal-back:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }
  
  /* Ad containers */
  #adsContainerTop,
  #adsContainerBottom {
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background: var(--surface);
    border-radius: var(--border-radius);
    margin: 1rem 0;
  }
  
  #adsContainerBottom {
    width: 100%;
    position: static;
    min-height: 90px;
    box-shadow: none;
    margin-top: 2rem;
  }
  
  /* Status messages */
  .status-message {
    text-align: center;
    padding: 2rem;
    color: var(--text-muted);
  }
  
  .status-error {
    color: var(--danger);
  }
  
  .status-success {
    color: var(--success);
  }
  
  /* Accessibility improvements */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  
  /* Focus styles for accessibility */
  button:focus-visible,
  a:focus-visible,
  input:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }
  
  /* Reduced motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
  
  /* Responsive design */
  @media (max-width: 768px) {
    :root {
      font-size: 15px;
    }
    
    header {
      padding: 1rem;
    }
    
    header h1 {
      font-size: 1.75rem;
    }
    
    .container {
      padding: 1rem;
      width: 95%;
      margin: 1rem auto;
    }
    
    .files {
      padding: 1rem;
      max-height: 65vh;
    }
    
    .file {
      padding: 1rem 0;
    }
    
    .thumbnail {
      width: 180px;
    }
    
    .footer-modal-content {
      padding: 1.5rem 1rem;
    }
    
    .footer-buttons-bottom {
      gap: 0.75rem;
    }
    
    .btn {
      padding: 0.6rem 1rem;
      font-size: 0.9rem;
    }
  }
  
  @media (max-width: 480px) {
    :root {
      font-size: 14px;
    }
    
    header h1 {
      font-size: 1.5rem;
    }
    
    .notice-box {
      padding: 1rem;
    }
    
    .thumbnail {
      width: 160px;
    }
    
    .footer-modal-content {
      width: 95%;
      padding: 1.25rem 0.75rem;
    }
    
    .footer-buttons-bottom {
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
    }
    
    .footer-btn {
      width: 100%;
      text-align: center;
    }
  }
.header-buttons {
  display: flex;
  gap: 0.5rem;
}
.header-btn {
  background: transparent;
  border: 1px solid var(--accent);
  color: var(--accent);
  padding: 0.4rem 0.75rem;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  font-weight: 600;
  transition: var(--transition);
}
.header-btn:hover {
  background: rgba(95, 251, 241, 0.15);
}
.filters select {
  padding: 0.6rem 1rem;
  border-radius: 8px;
  border: 2px solid var(--primary);
  background: var(--surface);
  color: var(--text-primary);
  font-size: 0.95rem;
  cursor: pointer;
  transition: var(--transition);
  appearance: none;
}
.filters select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(95, 251, 241, 0.3);
}

/* Help modal */
.help-modal {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.7);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}
.help-content {
  background: var(--surface);
  padding: 1.5rem;
  border-radius: var(--border-radius);
  color: var(--text-primary);
  max-width: 400px;
  text-align: center;
  box-shadow: var(--shadow);
}
.help-content h2 {
  color: var(--accent);
  margin-bottom: 1rem;
}
.help-content button {
  margin-top: 1rem;
  padding: 0.5rem 1rem;
  border: none;
  background: var(--primary);
  color: #fff;
  border-radius: 6px;
  cursor: pointer;
}
.help-content button:hover {
  background: var(--accent-dark);
}
/* prettier native selects + faux arrow */
.filters {
  display: flex;
  gap: 1rem;
  margin-top: 0.75rem;
  flex-wrap: wrap;
  justify-content: center;
  width: 100%;
}

.select-wrapper {
  position: relative;
  display: inline-block;
  min-width: 160px;
  flex: 1;
  max-width: 100%;
}

.select-wrapper select {
  width: 100%;
  padding: 0.6rem 2.2rem 0.6rem 1rem;
  border-radius: 8px;
  border: 2px solid var(--primary);
  background: linear-gradient(180deg, var(--surface) 0%, rgba(0,0,0,0.03) 100%);
  color: var(--text-primary);
  font-size: 0.95rem;
  cursor: pointer;
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  transition: var(--transition);
}
.select-wrapper::after {
  content: "▾";
  position: absolute;
  right: 0.9rem;
  top: 50%;
  transform: translateY(-50%);
  pointer-events: none;
  color: var(--text-secondary);
  font-size: 0.9rem;
}

/* focus + accessibility */
.select-wrapper select:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 4px rgba(95,251,241,0.06);
}

/* option styling (note: browser support is limited; this helps where browsers allow it) */
.select-wrapper select option {
  background: var(--surface);
  color: var(--text-primary);
  padding: 0.5rem 1rem;
}

/* selected option highlight in browsers that support it */
.select-wrapper select option:checked,
.select-wrapper select option[selected] {
  background: var(--accent);
  color: #031018;
}

/* hide native IE arrow */
.select-wrapper select::-ms-expand { display: none; }
@media (max-width: 768px) {
  .filters {
    flex-direction: column;
    align-items: center;
  }
  
  .select-wrapper {
    width: 100%;
    max-width: 300px;
  }
}

@media (max-width: 480px) {
  .select-wrapper {
    min-width: unset;
    width: 100%;
  }
  
  .select-wrapper select {
    padding: 0.6rem 1.8rem 0.6rem 0.8rem;
    font-size: 0.9rem;
  }
}
  </style>
  <!-- Google AdSense (replace with your ad IDs) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>
<body>
  <header role="banner">
  <h1>Minecraft packs</h1>
  <div class="header-buttons">
    <button id="helpBtn" class="header-btn">❔ Help</button>
    <button id="refreshBtn" class="header-btn">🔄 Refresh</button>
  </div>
</header>

<main class="container" role="main">
    <section class="notice-box" aria-labelledby="important-notice">
      <h2 id="important-notice">⚠️ Important Notice</h2>
      <p>Get our app: <a href="https://sifat8668.github.io/Mpacksapp/" target="_blank" rel="noopener">Mpacks app</a></p>
      <p>Or rename packs after downloading: e.g., <code>packname.mcpack.txt</code> → <code>packname.mcpack</code> (remove .txt)</p>
      
      <label for="searchInput" class="sr-only">Search packs</label>
      <input type="text" id="searchInput" placeholder="Search packs..." aria-label="Search packs">
<div class="filters">
  <div class="select-wrapper"><select id="fileType">
<option value="all">All Types</option>
<option value="mcpack">.mcpack</option>
<option value="mcworld">.mcworld</option>
</select></div>
  <div class="select-wrapper"><select id="sortBy">
<option value="az">A–Z Name</option>
<option value="za">Z–A Name</option>
<option value="largest">Largest First</option>
<option value="smallest">Smallest First</option>
</select></div>
</div>
    </section>
    
    <section aria-labelledby="files-heading">
      <h2 id="files-heading" class="sr-only">Available Minecraft Packs</h2>
      <div class="files" id="fileList" role="list" aria-label="List of Minecraft packs"></div>
    </section>
    
    <div class="footer-buttons-bottom">
      <button class="footer-btn" id="aboutBtn">About</button>
      <button class="footer-btn" id="privacyBtn">Privacy Policy</button>
      <button class="footer-btn" id="contactBtn">Contact</button>
    </div>
    
    <div id="loadingOverlay" role="status" aria-live="polite">
      <div class="loading-spinner" aria-hidden="true"></div>
      <div id="loadingText">Loading packs...</div>
    </div>
    
    <!-- Downloading Screen -->
    <div id="downloadingScreen" role="dialog" aria-labelledby="downloadFileName" aria-modal="true">
      <div id="downloadBar">
        <div id="downloadFileName" role="heading"></div>
        <div id="progressBarContainer">
          <div id="progressBar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <div id="progressText" aria-live="polite"></div>
        <button id="downloadCancelBtn">Cancel Download</button>
      </div>
    </div>
    
    <!-- Banner ads bottom -->
    <div id="adsContainerBottom" aria-label="Advertisement">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="there is your ad id"
           data-ad-slot="there is your ad code"
           data-ad-format="auto"
           data-full-width-responsive="true"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
    
    <!-- Modal popup for footer sections -->
    <div class="footer-modal" id="footerModal" role="dialog" aria-modal="true">
      <div class="footer-modal-content" id="footerModalContent">
        <button class="footer-modal-back" id="footerModalBack">Back</button>
      </div>
    </div>
<div id="helpModal" class="help-modal">
  <div class="help-content">
    <h2>Help</h2>
    <p>Use the search bar to find packs.<br>
    Filter by file type and sort order below the search.<br>
    Click Download to get the file.</p>
    <button id="helpClose">Close</button>
  </div>
</div>
  </main>
  
  <script>
  // Simple JS firewall for GitHub Pages
  (function() {
    // 1. Block known malicious bots by User-Agent
    const blockedAgents = ["sqlmap", "nikto", "curl", "wget", "fuzz", "acunetix", "scan", "hack"];
    const ua = navigator.userAgent.toLowerCase();
    if (blockedAgents.some(bot => ua.includes(bot))) {
        document.body.innerHTML = "<h1 style='color:var(--danger);text-align:center;margin-top:50px;padding:2rem;'>Access Denied</h1>";
        throw new Error("Blocked User-Agent");
    }

    // 2. Prevent suspicious query parameters
    const badPatterns = [/(\.\.\/|<script|%3Cscript|\/etc\/passwd|union.*select|insert.*into|drop.*table|delete.*from|script.*src)/i];
    const urlParams = new URLSearchParams(window.location.search);
    for (const [key, value] of urlParams) {
        if (badPatterns.some(rx => rx.test(key) || rx.test(value))) {
            document.body.innerHTML = "<h1 style='color:var(--danger);text-align:center;margin-top:50px;padding:2rem;'>Suspicious Activity Detected</h1>";
            throw new Error("Blocked suspicious query");
        }
    }
  })();

  // Main application
  (function() {
    // Constants
    const GH_USERNAME = "sifat8668";
    const GH_REPO = "M-packs";
    const API_URL = `https://api.github.com/repos/${GH_USERNAME}/${GH_REPO}/contents/`;
    const RAW_URL = `https://raw.githubusercontent.com/${GH_USERNAME}/${GH_REPO}/main/`;
    const CACHE_KEY = 'mc_packs_cache';
    const CACHE_TIMEOUT = 5 * 60 * 1000; // 5 minutes

    // DOM elements
    const fileList = document.getElementById('fileList');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const searchInput = document.getElementById('searchInput');
    const downloadingScreen = document.getElementById('downloadingScreen');
    const downloadFileName = document.getElementById('downloadFileName');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    const downloadCancelBtn = document.getElementById('downloadCancelBtn');
const fileTypeSelect = document.getElementById('fileType');
    const sortBySelect = document.getElementById('sortBy');
    // Global variables
    let allFiles = [];
    let allThumbs = {};
    let currentDownload = null;

    // Modal elements and functionality
    const aboutBtn = document.getElementById('aboutBtn');
    const privacyBtn = document.getElementById('privacyBtn');
    const contactBtn = document.getElementById('contactBtn');
    const footerModal = document.getElementById('footerModal');
    const footerModalContent = document.getElementById('footerModalContent');
    const footerModalBack = document.getElementById('footerModalBack');

    // Modal section data
    const FOOTER_SECTIONS = {
      about: {
        title: "About",
        content: `Welcome to Minecraft File Manager! This website allows you to easily browse, search, and download Minecraft packs (.mcpack, .mcworld). We provide a simple and secure way for the Minecraft community to discover new content. All packs are carefully curated for your gameplay experience.`
      },
      privacy: {
        title: "Privacy Policy",
        content: `Your privacy is important to us. We do not collect personal data from users. Some non-personal information may be collected by third-party services (like Google AdSense) for analytics and advertising purposes. For details, please review the privacy policies of these respective services.`
      },
      contact: {
        title: "Contact",
        content: `Have questions, feedback, or need support? You can reach out to us via email at <a href="mailto:nursifat3026@gmail.com" class="footer-contact-link">nursifat3026@gmail.com</a>. We appreciate your feedback and will respond as soon as possible.`
      }
    };

    // Utility functions
    function humanFileSize(size) {
      if (size < 1024) return size + " B";
      if (size < 1024 * 1024) return (size/1024).toFixed(1) + " KB";
      if (size < 1024 * 1024 * 1024) return (size/1024/1024).toFixed(1) + " MB";
      return (size/1024/1024/1024).toFixed(2) + " GB";
    }

    function sanitizeHTML(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.className = `status-message status-${type}`;
      notification.textContent = message;
      notification.setAttribute('role', 'alert');
      notification.setAttribute('aria-live', 'assertive');
      
      // Add to page
      document.body.appendChild(notification);
      
      // Remove after delay
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 5000);
    }

    // Recursively get all files from repo with caching
    async function fetchAllFiles(apiUrl = API_URL, prefix = '') {
      // Check cache first
      const cachedData = localStorage.getItem(CACHE_KEY);
      if (cachedData) {
        const { data, timestamp } = JSON.parse(cachedData);
        if (Date.now() - timestamp < CACHE_TIMEOUT) {
          return data;
        }
      }

      try {
        loadingOverlay.style.display = 'flex';
        document.getElementById('loadingText').textContent = "Loading packs...";
        
        const response = await fetch(apiUrl);
        
        // Check for rate limiting
        if (response.status === 403 && response.headers.get('x-ratelimit-remaining') === '0') {
          const resetTime = new Date(parseInt(response.headers.get('x-ratelimit-reset')) * 1000);
          const timeUntilReset = Math.round((resetTime - new Date()) / 60000);
          throw new Error(`GitHub API rate limit exceeded. Please try again in ${timeUntilReset} minutes.`);
        }
        
        if (!response.ok) throw new Error(`Failed to fetch repository contents: ${response.status} ${response.statusText}`);
        
        const data = await response.json();
        let files = [];
        
        for (const file of data) {
          if (file.type === 'dir') {
            const subFiles = await fetchAllFiles(file.url, prefix + file.name + '/');
            files = files.concat(subFiles);
          } else {
            files.push({ ...file, path: prefix + file.name });
          }
        }
        
        // Cache the results
        localStorage.setItem(CACHE_KEY, JSON.stringify({
          data: files,
          timestamp: Date.now()
        }));
        
        return files;
      } catch (error) {
        console.error('Error fetching files:', error);
        showNotification(error.message, 'error');
        return [];
      } finally {
        loadingOverlay.style.display = 'none';
      }
    }

    // Fetch and process files
    async function fetchFiles() {
      try {
        let data = await fetchAllFiles();
        
        // If no data, try again after a delay
        let tryCount = 0;
        while ((data.length === 0 || !data.some(f => f.name.match(/\.mcpack$|\.mcworld$/i))) && tryCount < 3) {
          await new Promise(r => setTimeout(r, 2000));
          data = await fetchAllFiles();
          tryCount++;
        }
        
        if (data.length === 0) {
          throw new Error("No files found in repository.");
        }
        
        const sorted = data.sort((a, b) => a.name.localeCompare(b.name));
        allThumbs = {};
        
        // Process thumbnails
        sorted.forEach(file => {
          if (file.name.toLowerCase().endsWith('.png')) {
            const base = file.name.replace(/\.png$/i, '').toLowerCase();
            allThumbs[base] = RAW_URL + file.path;
          }
        });

        // Process Minecraft files
        const mcFiles = sorted.filter(file =>
          file.name.match(/\.mcpack$/i) || file.name.match(/\.mcworld$/i)
        ).map(file => ({
          name: file.name,
          download_url: RAW_URL + file.path,
          size: file.size,
          thumb: allThumbs[file.name.replace(/\.(mcpack|mcworld)$/i,'').toLowerCase()] || null,
          type: file.name.match(/\.mcpack$/i) ? 'resource pack' : 'world'
        }));

        allFiles = mcFiles;
        renderFiles(mcFiles);
      } catch (error) {
        console.error('Error processing files:', error);
        fileList.innerHTML = `<div class="status-message status-error">${sanitizeHTML(error.message)}</div>`;
      }
    }

    // Render files to the DOM
    function renderFiles(filesToRender) {
      fileList.innerHTML = "";
      
      if (filesToRender.length === 0) {
        fileList.innerHTML = '<div class="status-message">No .mcpack or .mcworld files found.</div>';
        return;
      }
      
      filesToRender.forEach(file => {
        const div = document.createElement('div');
        div.className = 'file';
        div.setAttribute('role', 'listitem');

        // Thumbnail
        if (file.thumb) {
          const thumb = document.createElement('img');
          thumb.className = 'thumbnail';
          thumb.src = file.thumb;
          thumb.alt = `Thumbnail for ${file.name}`;
          thumb.loading = 'lazy';
          thumb.onerror = function() {
            thumb.style.display = 'none';
          };
          div.appendChild(thumb);
        }

        // File name
        const name = document.createElement('div');
        name.className = 'name';
        name.textContent = file.name;
        div.appendChild(name);

        // Meta information
        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.innerHTML = `
          <span>${humanFileSize(file.size)}</span>
          <span>•</span>
          <span>${file.type}</span>
        `;
        div.appendChild(meta);

        // Actions
        const actions = document.createElement('div');
        actions.className = 'actions';
        
        const dl = document.createElement('button');
        dl.className = 'btn';
        dl.innerHTML = `<span aria-hidden="true">⬇️</span> Download`;
        dl.onclick = () => startDownload(file);
        actions.appendChild(dl);
        
        div.appendChild(actions);
        fileList.appendChild(div);
      });
    }

    // Search functionality
    function setupSearch() {
      function applyFiltersAndSearch() {
        let filtered = allFiles;

        // Search
        const query = searchInput.value.trim().toLowerCase();
        if (query) {
          filtered = filtered.filter(f => f.name.toLowerCase().includes(query));
        }

        // Filter by type
        const type = fileTypeSelect.value;
        if (type !== 'all') {
          filtered = filtered.filter(f => f.name.toLowerCase().endsWith('.' + type));
        }

        // Sorting
        switch (sortBySelect.value) {
          case 'az':
            filtered.sort((a,b) => a.name.localeCompare(b.name));
            break;
          case 'za':
            filtered.sort((a,b) => b.name.localeCompare(a.name));
            break;
          case 'largest':
            filtered.sort((a,b) => b.size - a.size);
            break;
          case 'smallest':
            filtered.sort((a,b) => a.size - b.size);
            break;
        }

        renderFiles(filtered);
      }

      // Events
      let searchTimeout;
      searchInput.addEventListener('input', () => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(applyFiltersAndSearch, 300);
      });
      fileTypeSelect.addEventListener('change', applyFiltersAndSearch);
      sortBySelect.addEventListener('change', applyFiltersAndSearch);
    }

    // Download functionality
    function startDownload(file) {
      // Show UI
      downloadingScreen.style.display = 'flex';
      downloadCancelBtn.style.display = 'block';

      let downloadName;
      if (file.name.match(/\.mcpack$/i)) {
        downloadName = file.name.replace(/(\.mcpack)?(\.txt)?$/i, '') + '.mcpack';
      } else if (file.name.match(/\.mcworld$/i)) {
        downloadName = file.name.replace(/(\.mcworld)?(\.txt)?$/i, '') + '.mcworld';
      } else {
        downloadName = file.name;
      }
      
      downloadFileName.textContent = `${downloadName} (${humanFileSize(file.size)})`;
      progressBar.style.width = "0";
      progressBar.setAttribute('aria-valuenow', 0);
      
      let downloadedBytes = 0;
      let allowClose = false;
      let canCancel = false;
      let controller = new AbortController();
      currentDownload = controller;

      progressText.textContent = "Starting download...";

      // Cancel download on page leave/tab hide
      function abortDownloadIfActive() {
        if (currentDownload && !allowClose) {
          controller.abort();
        }
      }
      
      function beforeUnloadHandler(e) {
        abortDownloadIfActive();
        e.preventDefault();
        e.returnValue = '';
      }
      
      function visibilityChangeHandler() {
        if (document.visibilityState === "hidden") {
          abortDownloadIfActive();
        }
      }
      
      window.addEventListener('beforeunload', beforeUnloadHandler);
      document.addEventListener('visibilitychange', visibilityChangeHandler);

      fetch(file.download_url, {signal: controller.signal})
        .then(response => {
          if (!response.ok) throw new Error("Failed to download file.");
          
          const total = file.size || parseInt(response.headers.get('content-length')) || 0;
          const reader = response.body.getReader();
          const chunks = [];
          
          function read() {
            return reader.read().then(({done, value}) => {
              if (done) {
                // Download complete
                window.removeEventListener('beforeunload', beforeUnloadHandler);
                document.removeEventListener('visibilitychange', visibilityChangeHandler);
                
                downloadingScreen.style.display = 'none';
                currentDownload = null;
                
                const blob = new Blob(chunks);
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                
                a.href = url;
                a.download = downloadName;
                a.style.display = 'none';
                
                document.body.appendChild(a);
                a.click();
                
                setTimeout(() => {
                  document.body.removeChild(a);
                  URL.revokeObjectURL(url);
                  showNotification(`Download complete: ${downloadName}`, 'success');
                }, 100);
                
                return;
              }
              
              chunks.push(value);
              downloadedBytes += value.length;
              
              const percent = total > 0 ? Math.min(100, ((downloadedBytes / total) * 100)) : 0;
              progressBar.style.width = percent + "%";
              progressBar.setAttribute('aria-valuenow', percent);
              
              progressText.textContent = `Downloaded ${humanFileSize(downloadedBytes)} of ${humanFileSize(total)} (${percent.toFixed(1)}%)`;
              
              // Allow canceling after 10% progress
              if (percent >= 10 && !allowClose) {
                allowClose = true;
                canCancel = true;
                progressText.textContent += "\nYou can now safely cancel the download if needed.";
              }
              
              return read();
            }).catch(err => {
              if (controller.signal.aborted) {
                progressText.textContent = "Download cancelled.";
              } else {
                progressText.textContent = "Error during download: " + err.message;
              }
              
              downloadingScreen.style.display = 'none';
              window.removeEventListener('beforeunload', beforeUnloadHandler);
              document.removeEventListener('visibilitychange', visibilityChangeHandler);
              currentDownload = null;
            });
          }
          
          return read();
        }).catch(err => {
          if (err.name === 'AbortError') {
            progressText.textContent = "Download cancelled.";
          } else {
            progressText.textContent = "Error: " + err.message;
            showNotification("Download failed: " + err.message, 'error');
          }
          
          downloadingScreen.style.display = 'none';
          window.removeEventListener('beforeunload', beforeUnloadHandler);
          document.removeEventListener('visibilitychange', visibilityChangeHandler);
          currentDownload = null;
        });

      downloadCancelBtn.onclick = function() {
        if (canCancel && currentDownload) {
          controller.abort();
          downloadCancelBtn.style.display = "none";
        }
      };
    }

    // Modal functionality
    function setupModal() {
      function openFooterModal(sectionKey) {
        const data = FOOTER_SECTIONS[sectionKey];
        if (!data) return;
        
        // Clear previous content
        const existingTitle = footerModalContent.querySelector('.footer-section-title');
        const existingContent = footerModalContent.querySelector('.footer-section-content');
        
        if (existingTitle) existingTitle.remove();
        if (existingContent) existingContent.remove();
        
        // Create title
        const titleDiv = document.createElement('div');
        titleDiv.className = 'footer-section-title';
        titleDiv.textContent = data.title;
        titleDiv.id = 'modalTitle';
        footerModalContent.insertBefore(titleDiv, footerModalBack);
        
        // Create content
        const contentDiv = document.createElement('div');
        contentDiv.className = 'footer-section-content';
        contentDiv.innerHTML = data.content;
        footerModalContent.insertBefore(contentDiv, footerModalBack);
        
        // Show modal
        footerModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        // Set focus for accessibility
        setTimeout(() => {
          footerModalBack.focus();
        }, 100);
      }

      function closeFooterModal() {
        footerModal.style.display = 'none';
        document.body.style.overflow = '';
      }

      aboutBtn.onclick = () => openFooterModal('about');
      privacyBtn.onclick = () => openFooterModal('privacy');
      contactBtn.onclick = () => openFooterModal('contact');
      footerModalBack.onclick = closeFooterModal;

      // Close modal if background is clicked or Escape key is pressed
      footerModal.addEventListener('click', function(e) {
        if (e.target === footerModal) closeFooterModal();
      });
      
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && footerModal.style.display === 'flex') {
          closeFooterModal();
        }
      });
    }

    // Initialize the application
    function init() {
      setupSearch();
      setupModal();
      fetchFiles();
      
      // Clear cache on shift+click for debugging
      document.addEventListener('click', (e) => {
        if (e.shiftKey && e.button === 0) {
          localStorage.removeItem(CACHE_KEY);
          showNotification('Cache cleared', 'success');
          fetchFiles();
        }
      });
    }

    // Start the application
    document.addEventListener('DOMContentLoaded', init);
// Help + Refresh buttons
    document.getElementById('refreshBtn').onclick = () => location.reload();

    const helpModal = document.getElementById('helpModal');
    const helpClose = document.getElementById('helpClose');
    document.getElementById('helpBtn').onclick = () => helpModal.style.display = 'flex';
    helpClose.onclick = () => helpModal.style.display = 'none';
  })();
  </script>
</body>
</html>